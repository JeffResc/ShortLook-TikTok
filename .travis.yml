os: osx
osx_image: xcode10.2
language: objective-c
sudo: false
env:
  global:
  - THEOS=~/theos
before_install:
  - brew update
  - brew install dpkg ldid
  - git clone --recursive git://github.com/theos/theos.git ~/theos
script:
  - "export VERSION=$(grep 'Version: ' control | sed 's/^.*: //')"
  - "export DESCRIPTION=$(awk '/## v$VERSION/{getline; print}' README.md)"
  - "export FILENAME='packages/'\"$(grep 'Package: ' control | sed 's/^.*: //')\"'_'\"$VERSION\"'_iphoneos-arm.deb'"
  - make package
before_deploy:
  - git config --local user.name "Jeff Rescignano"
  - git config --local user.email "jeff@jeffresc.com"
  - git tag -a v$VERSION -m "$DESCRIPTION"
deploy:
  provider: releases
  api_key:
    secure: oenBGrADJ0VSpMLqdApllcdznogfAp2j5B7etxVLh1eD4P1+0sIgeg51vONydtBcWNRhdLe3f0H5lYfjV6q8ddV0XBSuty0RQsu1/uMFlhAwzIZeu5++RBk4EWhxKRXmX39PnkIsGimUU5Nciandp/UbFUrTMeql0yfTPOnBrqDSjsy7w6OiDNzMivUOLm5hC89ApqmTKpIiBY8s+PZlHYlZLx4e2M2HnxqlstaSpWbtDl8s4iGvDGgLOEGDNCdopXLIEzrh9CTuZQWRdiTQRT80lJcPk2xt28+YWaYg+xMzM2bviq8H5amEt9eNefSKwS5yZAtvS+c+bmm5lj0uTmrQ9Bh57lAaqRPgfm0HLN6glCGeQgyTVZZP9YVrYvgbXHN9EDnmt6uPz07wcJ7T3OQqTrArgyS83JdnVXUkZB3wXAh60ume09YFQUwilurBex2EzwpWejk0UeGdTXcqu/NjdZiaeOxu6/nmvEI9DEFDhSxKeezOZVYlfzyqwHGXnpi4+LEz+KrJpKD8jMJ4GYZVMuXtkBgs2gzS8FaNa+45CYuUJisKl5VJCljkgkkgDeXed0B+pLq3bfnSN2ovyEj1o5tZEtoiUKIS35aGamFc9IwNsxMu8o/oNRDznoJuRzc+66rrNNAKYRphSGrEC6kGzKFQW6dxZqvwD3siYlk=
  file: $FILENAME
  skip_cleanup: true
  on:
    branches:
      only:
        - release
